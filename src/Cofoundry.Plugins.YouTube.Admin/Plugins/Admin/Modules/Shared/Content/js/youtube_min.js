/*! BasicTestSite 2018-03-28 */
angular.module("cms.shared").factory("shared.youTubeService",["$http","$q",function(a,b){function c(){var c=b.defer();return a.get.apply(this,arguments).then(c.resolve)["catch"](function(a){404==a.status&&c.resolve(),c.reject(a)}),c.promise}var d={},e="https://www.googleapis.com/youtube/v3/videos?id=";return d.getVideoInfo=function(a){return c(e+a+"&part=contentDetails&key=").then(function(a){return a&&a.data?a.data[0]:void 0})},d}]),angular.module("cms.shared").directive("cmsFormFieldYoutube",["_","shared.pluginModulePath","shared.pluginContentPath","shared.modalDialogService","shared.stringUtilities","baseFormFieldFactory",function(a,b,c,d,e,f){function g(c,e,f,g){function i(){n.showPicker=k,n.remove=j,n.isRemovable=n.model&&!o,m()}function j(){l(null)}function k(){d.show({templateUrl:b+"UIComponents/YouTubePickerDialog.html",controller:"YoutubePickerDialogController",options:{currentVideo:a.clone(n.model),modelType:n.modelType,onSelected:l}})}function l(a){a?(n.isRemovable=!o,n.model=a):(n.isRemovable=!1,n.model&&(n.model=null)),m()}function m(){n.buttonText=n.model?"Change":"Select"}var n=c.vm,o=a.has(f,"required");return i(),h.link(c,e,f,g)}var h=f.defaultConfig,i={templateUrl:b+"UIComponents/FormFieldYouTube.html",scope:a.extend(f.defaultConfig.scope,{modelType:"@cmsModelType"}),passThroughAttributes:["required"],link:g};return f.create(i)}]),angular.module("cms.shared").directive("cmsFormFieldYoutubeId",["_","shared.pluginModulePath","shared.LoadState","shared.youTubeService","shared.validationErrorService","baseFormFieldFactory",function(a,b,c,d,e,f){function g(b,d,g,h){function i(){n.setEditing=l.bind(null,!0),n.updateVideoId=j,n.cancelEditing=k,n.updateIdLoadState=new c,b.$watch("vm.model",function(a){l(!a)})}function j(){function a(a){a?(n.model=n.idOrUrlInput=f,b(a)):c("Video not found")}function b(a){n.onVideoSelected&&n.onVideoSelected({model:a})}function c(a){e.raise([{properties:[n.modelName],message:a}])}var d=n.idOrUrlInput,f=m(d);d?d&&!f?c("The url/id is invalid"):f&&f!=n.model?a({id:f}):k():(n.model=null,b(null))}function k(){n.idOrUrlInput=n.model,n.onChange(),l(!1)}function l(a){n.isEditing=a}function m(a){var b,c=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i;if(a)return/^[^"&?\/ ]{11}$/.test(a)?a:(b=c.exec(a),b&&b[1])}var n=b.vm;a.has(g,"required"),h[0];return i(),f.defaultConfig.link(b,d,g,h)}var h={templateUrl:b+"UIComponents/FormFieldYouTubeId.html",scope:a.extend(f.defaultConfig.scope,{onVideoSelected:"&cmsOnVideoSelected"}),passThroughAttributes:["required"],link:g};return f.create(h)}]),angular.module("cms.shared").controller("YoutubePickerDialogController",["$scope","shared.LoadState","shared.stringUtilities","shared.youTubeService","options","close",function(a,b,c,d,e,f){function g(){k.onOk=j,k.onCancel=i,k.close=i,k.onVideoSelected=h,k.isModelId="id"===e.modelType,k.loadState=new b,k.isModelId&&e.currentVideo?(k.loadState.on(),youTubeService.getVideoInfo(e.currentVideo).then(h)["finally"](k.loadState.off)):k.model=e.currentVideo}function h(a){a?k.model={id:a.id,title:a.title,width:a.width,height:a.height,uploadDate:a.upload_date,thumbnailUrl:a.thumbnailUrl,thumbnailWidth:a.thumbnail_width,thumbnailHeight:a.thumbnail_height}:k.model=null}function i(){f()}function j(){k.model&&k.isModelId?e.onSelected(k.model.id):e.onSelected(k.model),f()}var k=a;g()}]),angular.module("cms.shared").directive("cmsYoutubeVideo",["$sce","shared.pluginModulePath","shared.pluginContentPath","shared.urlLibrary",function(a,b,c,d){return{restrict:"E",scope:{model:"=cmsModel"},templateUrl:b+"UIComponents/YouTubeVideo.html",link:function(b,d,e){b.replacementUrl=c+"img/AssetReplacement/youtube-replacement.png",b.$watch("model",function(c){var d;c?(d=c.id||c,b.videoUrl=a.trustAsResourceUrl("http://www.youtube.com/embed/"+d)):b.videoUrl=null})}}}]);