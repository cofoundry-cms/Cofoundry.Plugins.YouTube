/*! BasicTestSite 2018-03-29 */
angular.module("cms.shared").factory("shared.youTubeService",["$http","$q","shared.pluginServiceBase",function(a,b,c){function d(a){f=a.apiKey}function e(){var c=b.defer();return a.get.apply(this,arguments).then(c.resolve)["catch"](function(a){404==a.status&&c.resolve(),c.reject(a)}),c.promise}var f,g={},h="https://www.googleapis.com/youtube/v3/videos?id=";return a.get(c+"youtube-settings").then(d),g.getVideoInfo=function(a){if(f)return e(h+a+"&part=snippet&key="+f).then(function(b){if(b&&b.data&&b.data.items.length){var c=b.data.items[0],d=c.snippet,e=d.thumbnails.high,f={id:a,title:d.title,description:d.description,publishDate:d.publishedAt};return e&&(f.thumbnailUrl=e.url,f.thumbnailWidth=e.width,f.thumbnailHeight=e.height),f}});var c=b.defer();return c.resolve({id:a}),c.promise},g}]),angular.module("cms.shared").directive("cmsFormFieldYoutube",["_","shared.pluginModulePath","shared.pluginContentPath","shared.modalDialogService","shared.stringUtilities","baseFormFieldFactory",function(a,b,c,d,e,f){function g(c,e,f,g){function i(){n.showPicker=k,n.remove=j,n.isRemovable=n.model&&!o,m()}function j(){l(null)}function k(){d.show({templateUrl:b+"UIComponents/YouTubePickerDialog.html",controller:"YoutubePickerDialogController",options:{currentVideo:a.clone(n.model),modelType:n.modelType,onSelected:l}})}function l(a){a?(n.isRemovable=!o,n.model=a):(n.isRemovable=!1,n.model&&(n.model=null)),m()}function m(){n.buttonText=n.model?"Change":"Select"}var n=c.vm,o=a.has(f,"required");return i(),h.link(c,e,f,g)}var h=f.defaultConfig,i={templateUrl:b+"UIComponents/FormFieldYouTube.html",scope:a.extend(f.defaultConfig.scope,{modelType:"@cmsModelType"}),passThroughAttributes:["required"],link:g};return f.create(i)}]),angular.module("cms.shared").directive("cmsFormFieldYoutubeId",["_","shared.pluginModulePath","shared.LoadState","shared.youTubeService","shared.validationErrorService","baseFormFieldFactory",function(a,b,c,d,e,f){function g(b,g,h,i){function j(){o.setEditing=m.bind(null,!0),o.updateVideoId=k,o.cancelEditing=l,o.updateIdLoadState=new c,b.$watch("vm.model",function(a){m(!a)})}function k(){function a(a){f("There was a problem accessing YouTube")}function b(a){a?(o.model=o.idOrUrlInput=h,c(a)):f("Video not found")}function c(a){o.onVideoSelected&&o.onVideoSelected({model:a})}function f(a){e.raise([{properties:[o.modelName],message:a}])}var g=o.idOrUrlInput,h=n(g);g?g&&!h?f("The url/id is invalid"):h&&h!=o.model?(o.updateIdLoadState.on(),d.getVideoInfo(h).then(b)["catch"](a)["finally"](o.updateIdLoadState.off)):l():(o.model=null,c(null))}function l(){o.idOrUrlInput=o.model,o.onChange(),m(!1)}function m(a){o.isEditing=a}function n(a){var b,c=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i;if(a)return/^[^"&?\/ ]{11}$/.test(a)?a:(b=c.exec(a),b&&b[1])}var o=b.vm;a.has(h,"required"),i[0];return j(),f.defaultConfig.link(b,g,h,i)}var h={templateUrl:b+"UIComponents/FormFieldYouTubeId.html",scope:a.extend(f.defaultConfig.scope,{onVideoSelected:"&cmsOnVideoSelected"}),passThroughAttributes:["required"],link:g};return f.create(h)}]),angular.module("cms.shared").controller("YoutubePickerDialogController",["$scope","shared.LoadState","shared.stringUtilities","shared.youTubeService","options","close",function(a,b,c,d,e,f){function g(){k.onOk=j,k.onCancel=i,k.close=i,k.onVideoSelected=h,k.isModelId="id"===e.modelType,k.loadState=new b,k.isModelId&&e.currentVideo?(k.loadState.on(),youTubeService.getVideoInfo(e.currentVideo).then(h)["finally"](k.loadState.off)):k.model=e.currentVideo}function h(a){a?k.model=a:k.model=null}function i(){f()}function j(){k.model&&k.isModelId?e.onSelected(k.model.id):e.onSelected(k.model),f()}var k=a;g()}]),angular.module("cms.shared").directive("cmsYoutubeVideo",["$sce","shared.pluginModulePath","shared.pluginContentPath","shared.urlLibrary",function(a,b,c,d){return{restrict:"E",scope:{model:"=cmsModel"},templateUrl:b+"UIComponents/YouTubeVideo.html",link:function(b,d,e){b.replacementUrl=c+"img/AssetReplacement/youtube-replacement.png",b.$watch("model",function(c){var d;c?(d=c.id||c,b.videoUrl=a.trustAsResourceUrl("https://www.youtube-nocookie.com/embed/"+d)):b.videoUrl=null})}}}]);